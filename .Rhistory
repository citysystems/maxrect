}
for (i in 1:len_json){
arr <- drop(parcel_data[[i]])
parcel_data[[i]] <- removeCollinear(arr)
}
json_data <-  parcel_data        #### DOUBLE CHECK THIS VARIABLE EVERY TIME
# Find number of landlocked parcels (all points are touching another parcel)
# First, pull all the coordinates for the first polygon for each parcel
checkFront <- vector("logical", len_json)   # Keep track of whether a parcel touches the front
numFront <- vector("double", len_json)      # Keep track of number of points that touch the front
indexFront <- vector("list", len_json)      # Keep track of index of points that touch the front
for (i in 1:len_json){
print(i)
if (typeof(json_data[[i]]) == "list"){
poly <- unique(drop(json_data[[i]][[1]]))
}
else if (typeof(json_data[[i]]) == "double"){
# if (length(dim(json_data[[i]])) > 3){
# poly <- drop(json_data[[i]])[1,,]
poly <- unique(drop(json_data[[i]]))
# }
# else{poly <- unique(json_data[[i]][1,,])}
}
else{
break
}
indexFront[[i]] <- vector("logical", dim(poly)[1])
for (j in 1:dim(poly)[1]){
if (isFront1(poly[j,])){
checkFront[i] <- TRUE
indexFront[[i]][j] <- TRUE
numFront[i] <- numFront[i] + 1
}
}
}
sum(checkFront)
length(numFront[numFront == 0])
length(numFront[numFront == 1])
length(numFront[numFront == 2])
length(numFront[numFront > 2])
table(numFront)
chunks <- vector("double", len_json)              # chunks of points marked as front
false_chunks <- vector("double", len_json)        # chunks of points not marked as front (used to ID problems)
offsetFront <- vector("double", len_json)         # what number of points to move to the back
deleteFront <- vector("double", len_json)         # what index point to remove
chunks2 <- vector("double", len_json)              # chunks of points marked as front
false_chunks2 <- vector("double", len_json)        # chunks of points not marked as front (used to ID problems)
for (i in 1:len_json){
preVal <- FALSE
arr <- indexFront[[i]]
for (j in 1:length(arr)){
if (j == 1 && arr[j]){chunks[i] <- chunks[i] + 1}
else if (j == 1 && arr[j] == FALSE){false_chunks[i] <- false_chunks[i] + 1}
else if (preVal == FALSE && arr[j]){chunks[i] <- chunks[i] + 1}
else if (preVal && arr[j] == FALSE){false_chunks[i] <- false_chunks[i] + 1}
preVal <- arr[j]
}
# Track which parcel's front vertices need reordering
# If false_chunks < chunks, reorder by length of first true chunk
if (false_chunks[i] < chunks[i]){
for (j in 1:length(arr)){
if (!arr[j]){
break
}
offsetFront[i] <- offsetFront[i] + 1
}
indexFront[[i]] <- c(indexFront[[i]][-1:-offsetFront[i]], indexFront[[i]][1:offsetFront[i]])
}
preVal <- FALSE
for (j in 1:length(arr)){
if (j == 1 && indexFront[[i]][j]){chunks2[i] <- chunks2[i] + 1}
else if (j == 1 && indexFront[[i]][j] == FALSE){false_chunks2[i] <- false_chunks2[i] + 1}
else if (preVal == FALSE && indexFront[[i]][j]){chunks2[i] <- chunks2[i] + 1}
else if (preVal && indexFront[[i]][j] == FALSE){false_chunks2[i] <- false_chunks2[i] + 1}
preVal <- indexFront[[i]][j]
}
if (chunks2[i] == 2){
for (j in 2:(length(arr)-1)){
if (isTRUE(indexFront[[i]][j] && (!indexFront[[i]][j-1] && !indexFront[[i]][j+1]))){
deleteFront[i] <- j
}
}
}
}
table(chunks)
table(false_chunks)
table(chunks2)
table(false_chunks2)
table(deleteFront)
View(cbind(chunks, false_chunks))
View(cbind(chunks2, false_chunks2))
parcelFront <- vector(mode = "list", len_json)     # Keep track of the points that touch the front
# for (i in 1:len_json){
for (i in 1:len_json){
if (checkFront[i]){   # Check whether we need to save any points
parcelFront[[i]] <- array(dim = c(numFront[i],2))
index <- 1
if (typeof(json_data[[i]]) == "list"){
poly <- unique(drop(json_data[[i]][[1]]))
}
else if (typeof(json_data[[i]]) == "double"){
# if (length(dim(json_data[[i]])) > 3){
# poly <- drop(json_data[[i]])[1,,]
poly <- unique(drop(json_data[[i]]))
# }
# else{poly <- unique(json_data[[i]][1,,])}
}
for (j in 1:(dim(poly)[1])){
if (isFront1(poly[j,])){
parcelFront[[i]][index,] <- poly[j,]
index <- index + 1
}
}
}
if (deleteFront[i] > 0){
parcelFront[[i]] <- parcelFront[[i]][-deleteFront[i],]
}
# Check if indices need rearranging
if (offsetFront[i] > 0){
parcelFront[[i]] <- rbind(parcelFront[[i]][-1:-offsetFront[i], ], parcelFront[[i]][1:offsetFront[i], ])
}
}
for (i in 1:len_json){
print(i)
if (is.null(parcelFront[[i]])) {next}
if (dim(parcelFront[[i]])[1] == 1) {next}
else {
eqscplot(parcel_data[[i]], type="l")
points(parcelFront[[i]], pch = 16)
}   # Change it to plot the parcel and add the front points as dark circles
Sys.sleep(0.05)  # Pause and continues automatically
# invisible(readline(prompt="Press [enter] to continue"))  # Manually press enter to continue
}
cornerStats <- vector(mode = "list", len_json)
for (i in 1:len_json){
if(is.null(parcelFront[[i]])) {next}              # Skip landlocked
else if (dim(parcelFront[[i]])[1] < 3) {next}     # Skip parcels with 1 or 2 front points (most likly not a corner)
arr <- parcelFront[[i]]                           # Get the front points
# Find slopes
slope <- vector(mode = "double", length = dim(arr)[1]-1)
for (j in 1:length(slope)){
slope[j] <- atan2(arr[j+1,2]-arr[j,2], arr[j+1,1]-arr[j,1])
}
totslo1 <- atan2(arr[dim(arr)[1],2]-arr[1,2], arr[dim(arr)[1],1]-arr[1,1])
totslo2 <- totslo1 - pi
# Save slopes
cornerStats[[i]]$slopes <- slope
# Average slope
cornerStats[[i]]$avg <- mean(slope)
# Difference in slope between first segment and hypotenuse (first to last point)
cornerStats[[i]]$totdiff1 <- atan2(sin(totslo1-slope[1]),cos(totslo1-slope[1]))
# Difference in slope between last segment and hypotenuse (first to last point)
cornerStats[[i]]$totdiff2 <- atan2(sin(totslo2-slope[length(slope)]+pi),cos(totslo2-slope[length(slope)]+pi))
# Difference in slope between first segment and last segment
cornerStats[[i]]$segdiff <- atan2(sin(slope[length(slope)]-slope[1]), cos(slope[length(slope)]-slope[1]))
}
?save.image()
save.image(".RData")
segDiff <- vector("double", len_json)
View(segDiff)
?vector()
segDiff <- vector(len_json)
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
View(segDiff[(!is.null(segDiff[]))])
View(segDiff[(!is.null(segDiff))])
View(na.omit(segDiff))
segDiff <- na.omit(segDiff)
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- na.omit(segDiff)/180*pi
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- na.omit(segDiff)*180/pi
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- abs(na.omit(segDiff)*180/pi)
ggplot(segDiff) +
geom_histogram()
library(ggplot2)
ggplot(segDiff) +
geom_histogram()
data_frame(val = segDiff) %>%
ggplot(., aes(val)) +
geom_histogram()
data_frame(val = segDiff) %>%
ggplot(., aes(val)) +
geom_histogram(binwidth = 10)
eqscplot(parcel_data[[496]], type='l')
points(parcelFront[[496]], pch = 19)
View(cornerStats[[496]])
View(cornerStats)
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- cbind(segDiff, 1:len_json)
segDiff <- abs(na.omit(segDiff)*180/pi)
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- cbind(segDiff, 1:len_json)
?colnames()
colnames(segDiff) <- c("diff", "index")
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- cbind(segDiff, 1:len_json)
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
segDiff$diff <- abs(segDiff$diff/pi*180)
colnames(segDiff) <- c("diff", "index")
View(segDiff)
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- cbind(segDiff, 1:len_json)
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
segDiff[diff,] <- abs(segDiff[diff,]/pi*180)
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- cbind(segDiff, 1:len_json)
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
segDiff <- vector("double", len_json)
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i] <- NA
}
else {
segDiff[i] <- cornerStats[[i]]$segdiff
}
}
segDiff <- abs(segDiff/pi*180)
segDiff <- cbind(segDiff, 1:len_json)
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
data_frame(val = segDiff) %>%
ggplot(., aes(val)) +
geom_histogram(binwidth = 10)
segDiff %>%
ggplot(., aes(diff)) +
geom_histogram(binwidth = 10)
str(segDiff)
data_frame(segDiff) %>%
ggplot(., aes(diff)) +
geom_histogram(binwidth = 10)
View(tibble(segDiff))
View(data_frame(segDiff))
segDiff <- array("double", dim = c(len_json,2))
segDiff <- array("double", dim = c(len_json,2))
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i,1] <- NA
}
else {
segDiff[i,1] <- cornerStats[[i]]$segdiff
}
}
segDiff[,2] <- 1:len_json
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
View(segDiff)
segDiff <- array("double", dim = c(len_json,2))
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i,1] <- NA
}
else {
segDiff[i,1] <- cornerStats[[i]]$segdiff
}
}
segDiff[,1] <- abs(segDiff[,1]/pi*180)
segDiff[,2] <- 1:len_json
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
segDiff <- array("double", dim = c(len_json,2))
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i,1] <- NA
}
else {
segDiff[i,1] <- cornerStats[[i]]$segdiff
}
}
segDiff <- array("double", dim = c(len_json,2))
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i,1] <- NULL
}
else {
segDiff[i,1] <- cornerStats[[i]]$segdiff
}
}
segDiff <- array("double", dim = c(len_json,2))
?array()
segDiff <- array(dim = c(len_json,2))
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i,1] <- NA
}
else {
segDiff[i,1] <- cornerStats[[i]]$segdiff
}
}
segDiff[,1] <- abs(as.numeric(segDiff[,1])/pi*180)
segDiff[,2] <- 1:len_json
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
View(segDiff)
data_frame(segDiff) %>%
ggplot(., aes(diff)) +
geom_histogram(binwidth = 10)
segDiff %>%
ggplot(., aes(diff)) +
geom_histogram(binwidth = 10)
str(segDiff)
dataframe(val = segDiff[,1]) %>%
ggplot(., aes(val)) +
geom_histogram(binwidth = 10)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(val)) +
geom_histogram(binwidth = 10)
eqscplot(parcel_data[[2594]], type='l')
points(parcel_data[[2594]], pch = 19)
test <- removeCollinear(parcel_data[[2594]])
View(test)
View(cornerStats[[2594]])
points(parcelFront[[2594]], pch = 21)
points(parcelFront[[2594]], pch = 20)
points(parcelFront[[2594]], pch = 13)
View(parcelFront[[2594]])
full_json_data$APN[[2594]]
eqscplot(parcel_data[[1939]], type='l')
points(parcelFront[[1939]], pch = 13)
eqscplot(parcel_data[[2301]], type='l')
points(parcelFront[[2301]], pch = 13)
eqscplot(parcel_data[[1986]], type='l')
points(parcelFront[[1986]], pch = 13)
full_json_data$APN[[1986]]
full_json_data$address[[1986]]
eqscplot(parcel_data[[157]], type='l')
points(parcelFront[[157]], pch = 13)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(val)) +
geom_histogram(binwidth = 10)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = -val)) +
geom_histogram(aes(y = cumsum(..count..)), binwidth = 10)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = -val)) +
geom_histogram(aes(y = cumsum(..count..)/807), binwidth = 10)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/807), binwidth = 10) +
scale_x_reverse()
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/807), binwidth = 10) +
scale_x_reverse() +
theme(axis.ticks.x = 10)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/807), binwidth = 10) +
scale_x_reverse() +
theme(axis.ticks.x = c(180:0:10))
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/807), binwidth = 10) +
scale_x_reverse(breaks = seq(180, 0, 10))
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/807), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10))
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/807), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10)) +
scale_y_continuous(labels = scales::percent)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10)) +
scale_y_continuous(labels = scales::percent)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10)) +
scale_y_continuous(labels = percent)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/sum(..count..)), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10)) +
scale_y_continuous(labels = scales::percent)
segDiff <- array(dim = c(len_json,2))
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
segDiff[i,1] <- NA
}
else {
segDiff[i,1] <- abs(cornerStats[[i]]$segdiff)/pi*180
}
}
segDiff[,2] <- 1:len_json
colnames(segDiff) <- c("diff", "index")
segDiff <- na.omit(segDiff)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/sum(..count..)), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10)) +
scale_y_continuous(labels = scales::percent)
totDiff <- array(dim = c(len_json,2))
for (i in 1:len_json){
if (is.null(cornerStats[[i]])) {
totDiff[i,1] <- NA
}
else {
totDiff[i,1] <- abs(min(cornerStats[[i]]$totdiff1, cornerStats[[i]]$totdiff2))/pi*180
}
}
totDiff[,2] <- 1:len_json
colnames(totDiff) <- c("totdiff", "index")
totDiff <- na.omit(totDiff)
data_frame(val = totDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 10) +
scale_y_continuous(labels = scales::percent)
data_frame(val = totDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 5) +
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(limits = c(90, 0))
data_frame(val = totDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = ..count../sum(..count..)), binwidth = 5) +
scale_y_continuous(labels = scales::percent) +
scale_x_continuous(limits = c(0, 90))
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/sum(..count..)), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10), limits = c(0, 90)) +
scale_y_continuous(labels = scales::percent)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/sum(..count..)), binwidth = 10) +
scale_x_reverse(breaks = seq(0, 180, 10), limits = c(90, 0)) +
scale_y_continuous(labels = scales::percent)
data_frame(val = segDiff[,1]) %>%
ggplot(., aes(x = val)) +
geom_histogram(aes(y = cumsum(..count..)/sum(..count..)), binwidth = 5) +
scale_x_reverse(breaks = seq(0, 180, 10), limits = c(90, 0)) +
scale_y_continuous(labels = scales::percent)
load("~/GitHub/maxrect/.RData")
