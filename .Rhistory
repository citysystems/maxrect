filter(trip_mode <= 6) %>%
group_by(orig_taz, dest_taz, trip_mode) %>%
summarise(n = n())
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n())
head(indiv)
indiv_aggr_mode
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n()) %>%
mutate(
ifelse(
trip_mode <= 2,
count = n,
ifelse(
trip_mode <= 4,
count = n/2,
count = n/3
)
)
)
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n()) %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
)
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
)
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n())
indiv_aggr_mode
indiv_aggr_mode %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
)
?gather()
?slice()
indiv_test %>%
slice(5)
indiv_aggr_mode %>%
slice(5)
indiv_aggr_mode %>%
head(n = 5)
indiv_aggr_mode %>%
head(n = 5) %>%
group_by(orig_taz, dest_taz) %>%
summarize(count = sum(n))
indiv_aggr_car <-
indiv_aggr_mode %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
) %>%
group_by(orig_taz, dest_taz) %>%
summarize(car_count = sum(n))
x <- seq(2010, 2016, 1)
x <- seq(2010, 2016, 1)
x
library(tidyverse)
a <- seq(2010,2016,1)
b <- c(0.724, 0.717, 0.714, 0.707, 0.702, 0.699, 0.69)
trend.line(a,b)
mydf <- data.frame(x = a, y = b)
model <- lm(y ~ x, data = mydf)
plot(y ~ x, data = mydf)
model <- lm(y ~ x, data = mydf)
abline(model, col = "red")
summary(model)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(stringr)
knitr::opts_chunk$set(echo = TRUE)
file_base <- "~/224Z/"
indiv_file <- str_c(file_base, "indivTripData_3.csv")
joint_file <- str_c(file_base, "jointTripData_3.csv")
joint <- read_csv(joint_file)
indiv <- read_csv(indiv_file)
install.packages()
help(install.packages())
install.packages("tidyverse", dependencies = TRUE)
setwd("~/GitHub/maxrect")
load("~/GitHub/maxrect/G.RData")
library(maxrectangle)
library(jsonlite)
library(readr)
library(MASS)
library(sp)
library(dplyr)
library(plyr)
library(ggplot2)
library(ggrepel)
library(sf)
library(lwgeom)
# To show the result for an index:
# Choose a value for i
i <- 2
largestRect(result_Bldg0[i,], print = TRUE)
# To show the result for an index:
# Choose a value for i
i <- 3
largestRect(result_Bldg0[i,], print = TRUE)
# To show the result for an index:
# Choose a value for i
i <- 5
largestRect(result_Bldg0[i,], print = TRUE)
# To show the result for an index:
# Choose a value for i
i <- 7
largestRect(result_Bldg0[i,], print = TRUE)
for (i in 1:nrow(result_Bldg0)){
print(i)
largestRect(result_Bldg0[i,], print = TRUE)
}
# To show the result for an index:
# Choose a value for i
i <- 121
largestRect(result_Bldg0[i,], print = TRUE)
plot(bldg0_buildable[1,])
st_coordinates(bldg0_buildable[1,])
plot(st_multipolygon(lapply(bldg0_buildable[1,], function(x) bldg0_buildable[1,][1])))
plot(st_multipolygon(bldg0_buildable[1,][1]))
plot(st_polygon(bldg0_buildable[1,][1]))
plot(bldg0_buildable[1,][1])
plot(st_multipolygon(lapply(bldg0_buildable[1,], function(x) x[1])))
plot(st_polygon(lapply(bldg0_buildable[1,], function(x) x[1])))
lapply(bldg0_buildable[1,], function(x) x[1])
plot(lapply(bldg0_buildable[1,], function(x) x[1]))
library(smoothr)
install.packages("smoothr")
library(smoothr)
# To show the result for an index:
# Choose a value for i
i <- 1
largestRect(result_Bldg0[i,], print = TRUE)
test <- bldg0_buildable[1,] %>% fill_holes(., threshold = 1e99)
area_thresh <- units::set_units(1000, km^2)
test <- bldg0_buildable[1,] %>% fill_holes(., area_thresh)
area_thresh <- units::set_units(1000, km^2)
test <- fill_holes(bldg0_buildable[1,], area_thresh)
test <- fill_holes(bldg0_buildable[1,], 160)
area_thresh <- units::set_units(1000, m^2)
area_thresh
test <- fill_holes(bldg0_buildable[1,], area_thresh)
area_thresh <- units::set_units(1000, m^2)
test <- fill_holes.sf(bldg0_buildable[1,], area_thresh)
result_Bldg0[1,]
str(result_Bldg0[1,])
bldg0_buildable[1,]
View(bldgs)
bldgs[1,]
plot(bldgs[1,])
test <- bldg0_buildable[1,]
test <- test %>% st_set_crs(102643)
test
area_thresh <- units::set_units(1000, ft^2)
fill_holes(test, 1000)
test2 <- fill_holes(test, 1000)
plot(test)
plot(test2)
View(bldg0_buildable)
plot(bldg0_buildable[3,])
View(modParcel)
View(parcels)
parcels[1,]
st_geometry(parcels[1,])
parcels[1,]$geometry.coordinates
View(parcel)
View(closestRoad)
plot(bldg0_buildable[7,])
test <- bldg0_buildable[7,]
# Set CRS as 102643
test <- test %>% st_set_crs(102643)
test2 <- fill_holes(test, 1000)
plot(test)
plot(test2)
View(result_Bldg0)
plot(result_Bldg0[5,])
st_area(result_Bldg0[5,])
?st_combine()
result_Bldg0$APN
result_Bldg0$APN %>% mode()
?mode()
mode(result_Bldg0$APN)
test <- as.vector(result_Bldg0$APN)
View(test)
mode(test)
getmode <- function(v) {
uniqv <- unique(v)
uniqv[which.max(tabulate(match(v, uniqv)))]
}
?tabulate()
test
table(test)
?st_combine()
test <- result_Bldg0 %>% filter(APN == 062112030)
View(test)
test <- result_Bldg0[5:6,]
View(test)
plot(result_Bldg0)
plot(result_Bldg0$geometry)
plot(test)
plot(test$geometry)
plot(st_combine(test))
st_combine(test)
plot(st_multipolygon(st_combine(test)))
plot(st_combine(test))
plot(st_combine(test))
rownames(test) <- c()
test$xmin[1]
test$xmin[2]
for(i in 1:nrow(test)){
offset <- c(test$xmin[i], test$ymin[i])
test$geometry <- test$geometry + offset
xmin[i] <- 0
ymin[i] <- 0
}
for(i in 1:nrow(test)){
offset <- c(test$xmin[i], test$ymin[i])
test$geometry <- test$geometry + offset
test$xmin[i] <- 0
test$ymin[i] <- 0
}
test <- result_Bldg0[5:6,]
rownames(test) <- c()
for(i in 1:nrow(test)){
offset <- c(test$xmin[i], test$ymin[i])
test$geometry <- test$geometry + offset
test$xmin[i] <- 0
test$ymin[i] <- 0
}
test <- result_Bldg0[5:6,]
rownames(test) <- c()
for(i in 1:1){
offset <- c(test$xmin[i], test$ymin[i])
print(offset)
test$geometry <- test$geometry + offset
test$xmin[i] <- 0
test$ymin[i] <- 0
}
test <- result_Bldg0[5:6,]
rownames(test) <- c()
for(i in 1:nrow(test)){
offset <- c(test$xmin[i], test$ymin[i])
test$geometry[i] <- test$geometry[i] + offset
test$xmin[i] <- 0
test$ymin[i] <- 0
}
test <- st_combine(test)
test
plot(test)
test <- result_Bldg0[5:6,]
test <- result_Bldg0[5:6,]
rownames(test) <- c()
saveAPN <- test$APN[1]
for(i in 1:nrow(test)){
offset <- c(test$xmin[i], test$ymin[i])
test$geometry[i] <- test$geometry[i] + offset
test$xmin[i] <- 0
test$ymin[i] <- 0
}
st_combine(test)
test
?st_join()
?mapview()
install.packages("mapview")
library(mapview)
?mapview()
result_Bldg0 <- result_Bldg0 %>% st_set_crs(102643)
bldg0_buildable <- bldg0_buildable %>% st_set_crs(102643)
test <- result_Bldg0[5:6,]
rownames(test) <- c()
saveAPN <- test$APN[1]
for(i in 1:nrow(test)){
offset <- c(test$xmin[i], test$ymin[i])
test$geometry[i] <- test$geometry[i] + offset
test$xmin[i] <- 0
test$ymin[i] <- 0
}
?summarise()
test <- result_Bldg0 %>% group_by(APN) %>% summarise(APN = APN) %>% st_cast()
test <- result_Bldg0 %>% group_by(APN) %>% summarise(APN = mean(APN)) %>% st_cast()
View(test)
test <- result_Bldg0 %>% group_by(APN) %>% st_combine()
View(test)
test <- result_Bldg0 %>% split(.$APN) %>% lapply(st_combine)
View(test)
View(test)
test <- result_Bldg0 %>% split(.$APN) %>% lapply(st_combine) %>% do.call(c, .)
View(test)
test <- result_Bldg0 %>% split(.$APN) %>% lapply(st_combine) %>% do.call(c, .) %>% st_cast()
test <- result_Bldg0 %>% split(.$APN) %>% lapply(st_union) %>% do.call(c, .) %>% st_cast()
View(test)
plot(test[[5]])
test[[5]]
plot(test[[1]])
plot(test[[5]])
eqscplot(test[[5]])
plot(test[[1]])
plot(test[[2]])
plot(test[[11]])
?st_cast()
test2 <- test %>% st_cast("MULTIPOLYGON")
test <- result_Bldg0 %>% split(.$APN) %>% lapply(st_union) %>% do.call(c, .) %>% st_cast("MULTIPOLYGON")
plot(test[[5]][[1]])
plot(test[[5]][[1]][[1]])
plot(test[[5]][[1]][[1]], type='l')
eqscplot(test[[5]][[1]][[1]], type='l')
lines(test[[5]][[2]][[1]])
?eqscplot()
eqscplot(test[[5]][[1]][[1]], type='l', tol = 0.9)
lines(test[[5]][[2]][[1]])
result_Bldg0_noOffset <- result_Bldg0
result_Bldg0_noOffset <- result_Bldg0
result_Bldg0_offset <- result_Bldg0
# Return geometries to original coordinates, no offsets
for(i in 1:nrow(result_Bldg0)){
offset <- c(result_Bldg0$xmin[i], result_Bldg0$ymin[i])
result_Bldg0$geometry[i] <- result_Bldg0$geometry[i] + offset
result_Bldg0$xmin[i] <- 0
result_Bldg0$ymin[i] <- 0
}
View(result_Bldg0)
test <- result_Bldg0
test <- result_Bldg0 %>% split(.$APN) %>% lapply(st_union) %>% do.call(c, .) %>% st_cast()
View(test)
plot(test[[1]])
plot(test[[5]])
?do.call()
str(test)
?st_sf()
test2 <- st_sf(result_Bldg0$APN %>% unique(), test)
View(test2)
plot(test2[3773,])
plot(test2[3772,])
plot(test1[3773,])
plot(test[3773,])
plot(test[[3773]])
plot(test[[3773]], axes = TRUE)
plot(test2[2773,], axes = TRUE)
test2 <- st_sf(APN = result_Bldg0$APN %>% unique(), geometry = test)
View(test2)
# https://github.com/r-spatial/sf/issues/290
result_Bldg0_combined <- st_sf(APN = result_Bldg0$APN %>% unique(), geometry = result_Bldg0 %>% split(.$APN) %>% lapply(st_union) %>% do.call(c, .) %>% st_cast())
View(result_Bldg0_combined)
View(bldg0_buildable)
bldg0_buildable_combine <- st_sf(APN = bldg0_buildable$APN %>% unique(), geometry = bldg0_buildable %>% split(.$APN) %>% lapply(st_union) %>% do.call(c, .) %>% st_cast())
View(bldg0_buildable_combine)
?mapview()
mapview(result_Bldg0_combined)
mapview(result_Bldg0_combined, zcol = APN)
mapview(result_Bldg0_combined, zcol = apn)
mapview(result_Bldg0_combined, zcol = "APN")
mapview(result_Bldg0)
test <- result_Bldg0 %>% lapply(bbox)
test <- result_Bldg0 %>% lapply(st_bbox)
?st_bbox()
st_bbox(result_Bldg0[1,])
?lapply()
test <- result_Bldg0 %>% sapply(st_bbox)
?array()
bbox <- array(dim = c(4,1))
bbox
bbox <- array(dim = c(nrow(result_Bldg0),4))
for (i in 1:nrow(result_Bldg0)){
bbox[i,] <- st_bbox(result_Bldg0[i,])
}
View(bbox)
plot(result_Bldg0[4257,])
View(parcel)
View(result_Bldg0)
063411160
View(parcels)
View(parcel)
plot(parcels$geometry.coordinates[2880])
plot(parcels[2880,])
plot(parcel[[2880]][,1:2])
plot(parcel[[2880]][,1:2], type='l')
eqscplot(parcel[[2880]][,1:2], type='l')
eqscplot(parcel[[2880]][,1:2], type='l')
View(bldg_all)
lines(st_coordinates(bldg_all[2880,]))
View(bldg0_buildable)
063411160
View(result_Bldg0)
lines(st_coordinates(result_Bldg0[4257,]))
lines(st_coordinates(result_Bldg0[4258,]))
checkCorner(2880)
View(parcels)
st_bbox(parcels)
st_bbox(parcels %>% st_union())
parcels
str(parcels)
View(parcels)
View(parcels)
View(bldg_all)
test <- st_combine(bldg_all)
View(test)
st_bbox(test)
EPAbbox <- st_bbox(st_combine(bldg_all)) + c(-1000, -1000, 1000, 1000)
View(result_Bldg0)
# Check which result_Bldg0 results need to be fixed. Filter out the ones that show up outside of the EPAbbox
test <- reuslt_Bldg0
# Check which result_Bldg0 results need to be fixed. Filter out the ones that show up outside of the EPAbbox
test <- result_Bldg0
test$inBox <- FALSE
View(test)
st_bbox(result_Bldg0[1,])
for (i in 1:nrow(test)){
bbox <- st_bbox(test[i,])
if (bbox[1] >= EPAbbox[1] && bbox[2] >= EPAbbox[2] && bbox[3] <= EPAbbox[3] && bbox[4] <= EPAbbox[4]){
test$inBox[i] == TRUE
}
}
str(EPAbbox)
st_bbox(result_Bldg0[1,])[1] >= EPAbbox[1]
st_bbox(result_Bldg0[1,])[1] >= EPAbbox[1] && st_bbox(result_Bldg0[1,])[2] >= EPAbbox[2]
st_bbox(result_Bldg0[1,])[1] >= EPAbbox[1] && st_bbox(result_Bldg0[1,])[2] >= EPAbbox[2] && st_bbox(result_Bldg0[1,])[3] >= EPAbbox[3] && st_bbox(result_Bldg0[1,])[4] >= EPAbbox[4]
for (i in 1:nrow(test)){
print(i)
bbox <- st_bbox(test[i,])
if (bbox[1] >= EPAbbox[1] && bbox[2] >= EPAbbox[2] && bbox[3] <= EPAbbox[3] && bbox[4] <= EPAbbox[4]){
test$inBox[i] == TRUE
}
}
st_bbox(result_Bldg0[263,])"263"
st_bbox(result_Bldg0[263,])
for (i in 1:nrow(test)){
print(i)
bbox <- st_bbox(test[i,])
if (is.na(bbox[1])){next}
if (bbox[1] >= EPAbbox[1] && bbox[2] >= EPAbbox[2] && bbox[3] <= EPAbbox[3] && bbox[4] <= EPAbbox[4]){
test$inBox[i] == TRUE
}
}
result_Bldg0$inBox <- FALSE
for (i in 1:nrow(result_Bldg0)){
print(i)
bbox <- st_bbox(result_Bldg0[i,])
if (is.na(bbox[1])){next}
if (bbox[1] >= EPAbbox[1] && bbox[2] >= EPAbbox[2] && bbox[3] <= EPAbbox[3] && bbox[4] <= EPAbbox[4]){
result_Bldg0$inBox[i] == TRUE
}
}
View(result_Bldg0)
EPAbbox
is.na(EPAbbox)
for (i in 1:nrow(result_Bldg0)){
print(i)
bbox <- st_bbox(result_Bldg0[i,])
if (is.na(bbox[1])){next}
if (bbox[1] >= EPAbbox[1] && bbox[2] >= EPAbbox[2] && bbox[3] <= EPAbbox[3] && bbox[4] <= EPAbbox[4]){
print("success")
result_Bldg0$inBox[i] == TRUE
}
}
result_Bldg0$inBox <- FALSE
for (i in 1:nrow(result_Bldg0)){
print(i)
bbox <- st_bbox(result_Bldg0[i,])
if (is.na(bbox[1])){next}
if (bbox[1] >= EPAbbox[1] && bbox[2] >= EPAbbox[2] && bbox[3] <= EPAbbox[3] && bbox[4] <= EPAbbox[4]){
print("success")
result_Bldg0$inBox[i] = TRUE
}
}
View(result_Bldg0)
result_Bldg0_combined <- result_Bldg0 %>% filter(inBox == TRUE)
View(result_Bldg0_combined)
result_Bldg0_combined <- st_sf(APN = result_Bldg0_combined$APN %>% unique(), geometry = result_Bldg0_combined %>% split(.$APN) %>% lapply(st_union) %>% do.call(c, .) %>% st_cast())
View(result_Bldg0_combined)
mapview(result_Bldg0_combined)
View(parcels)
mapview(bldg_all)
mapview(bldg0_buildable_combine)
View(bldg0_buildable_combine)
View(result_Bldg0_offset)
