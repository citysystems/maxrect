ctx = initjs()
lr <- NULL
lr = find_lr(ctx, st_coordinates(test)[,1:2])
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
eqscplot(st_coordinates(test), type='l')
lines(st_coordinates(merged_rects))
ctx = initjs()
lr <- NULL
lr = find_lr(ctx, st_coordinates(result_Bldg0[2,])[,1:2])
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
?lines()
View(rects)
test <- cbind(c(0,200,200,300,200,100,200,200,400,400,0,0),c(0,0,100,200,300,200,100,0,0,400,400,0))
eqscplot(test)
eqscplot(test, type='l')
#for (i in 1:numPar){
#if (!misfits[i]){
ctx = initjs()
lr <- NULL
# lr = find_lr(ctx, st_coordinates(test)[,1:2])
lr = find_lr(ctx, test)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
lines(st_coordinates(merged_rects))
prepPoly <- function(poly){
minX <- min(poly[,1])              # get the smallest x coord
minY <- min(poly[,2])              # get the smallest y coord
poly[,1] <- poly[,1]- minX         # adjust for relative coordinates
poly[,2] <- poly[,2]- minY         # adjust for relative coordinates
return(list(poly,minX,minY))
}
#for (i in 1:numPar){
#if (!misfits[i]){
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# eqscplot(st_coordinates(test), type='l')
eqscplot(poly, type='l')
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
lines(st_coordinates(merged_rects))
View(parcel)
View(parcels)
View(result_Bldg0)
result_Bldg0 <- NULL
# need to fix 905, 3458, 3539, 3869
misfits[905] <- TRUE
misfits[3458] <- TRUE
misfits[3480] <- TRUE
misfits[3539] <- TRUE
misfits[3612] <- TRUE
misfits[3869] <- TRUE
for (i in 1:numPar){
if (!misfits[i]){
print(i)
par <- parcel[[i]][,1:2]
edges <- parcelEdges[[i]]
bldg <- st_coordinates(bldg_all[i,])[,1:2]
front <- parcelFront(i, "Mod")
side_dist <- 5
rear_dist <- 10
geom <- allBuffers(par, edges, bldg, front, side_dist, rear_dist, bldg_dist = 0.01)
if (is.character(geom) || nrow(geom) == 0){
sf <- st_sf(APN = parcels$properties.APN[[i]], valid = FALSE, geometry = st_sfc(st_polygon()))
}
else{
sf <- st_sf(data.frame(tibble(APN = parcels$properties.APN[[i]]),geom))
}
# result_Bldg0 <- rbind(result_Bldg0, sf)
}
}
for (i in 1:numPar){
if (!misfits[i]){
print(i)
par <- parcel[[i]][,1:2]
edges <- parcelEdges[[i]]
bldg <- st_coordinates(bldg_all[i,])[,1:2]
front <- parcelFront(i, "Mod")
side_dist <- 5
rear_dist <- 10
geom <- allBuffers(par, edges, bldg, front, side_dist, rear_dist, bldg_dist = 0.01)
if (is.character(geom) || nrow(geom) == 0){
sf <- st_sf(APN = parcels$properties.APN[[i]], valid = FALSE, geometry = st_sfc(st_polygon()))
}
else{
sf <- st_sf(data.frame(tibble(APN = parcels$properties.APN[[i]]),geom))
}
result_Bldg0 <- rbind(result_Bldg0, sf)
}
}
View(result_Bldg0)
eqscplot(st_coordinates(result_Bldg0[4,]), type='l')
?eqscplot()
eqscplot(st_coordinates(result_Bldg0[4,]), type='l', tol = 0.9)
lines(st_coordinates(result_Bldg0[5,]))
eqscplot(st_coordinates(result_Bldg0[5,]), type='l', tol = 0.9)
lines(st_coordinates(result_Bldg0[4,]))
result_Bldg0[1,1]
result_Bldg0[1,"APN"]
result_Bldg0[[1]]
result_Bldg0[[1]][1]
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
for (i in 1:1){
if (!misfits[i]){
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
eqscplot(poly + c(minX,minY), type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
sf <- st_sf(APN = result_Bldg0[[1]][i], geometry = st_sfc(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
}
eqscplot(st_coordinates(result_Bldg0[i,])[,1:2], type='l')
eqscplot(st_coordinates(result_Bldg0[i,]), type='l')
st_coordinates(result_Bldg0[i,])[,1:2]
i
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
lines(st_coordinates(merged_rects))
View(bldg0_buildable)
result_Bldg0[[1]][1]
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
View(bldg0_buildable)
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
length(result_Bldg0)
nrow(result_Bldg0)
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
i <- 1
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
View(bldg0_buildable)
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
for (i in 1:nrow(result_Bldg0)){
if (!misfits[i]){
print(i)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
# eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
# lines(st_coordinates(merged_rects))
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
}
View(lr)
dim(lr[[3]])
lr[[3]]
length(lr[[3]])
dim(lr[[3]])
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
for (i in 1:nrow(result_Bldg0)){
if (!misfits[i]){
print(i)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (!is.na(dim(lr[[3]]))){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
# eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
# lines(st_coordinates(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
}
View(lr)
dim(lr[[3]])
i <- 1
if (!misfits[i]){
print(i)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (!is.na(dim(lr[[3]]))){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
# eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
# lines(st_coordinates(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
View(lr)
View(lr)
is.array(lr[[3]])
i <- 3
if (!misfits[i]){
print(i)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (!is.na(dim(lr[[3]]))){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
# eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
# lines(st_coordinates(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
View(lr)
View(lr)
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
for (i in 1:nrow(result_Bldg0)){
if (!misfits[i]){
print(i)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
# eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
# lines(st_coordinates(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
}
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
prep <- prepPoly(st_coordinates(result_Bldg0[i,])[,1:2])
View(result_Bldg0)
View(lr)
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
View(lr)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
i <- 1
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(merged_rects))
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
for (i in 1:nrow(result_Bldg0)){
if (!misfits[i]){
print(i)
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
# eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
# lines(st_coordinates(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
}
eqscplot(st_coordinates(result_Bldg0[132,])[,1:2], type='l')
View(st_coordinates(result_Bldg0[132,])
)
st_area(result_Bldg0[132,])
for (i in 132:nrow(result_Bldg0)){
if (!misfits[i] && st_area(result_Bldg0[i,]) > 160){
print(i)
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
# eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
# lines(st_coordinates(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
}
}
View(bldg0_buildable)
# To save current environment
save.image(".RData")
