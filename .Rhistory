buildable_aadu <- rbind(buildable_aadu, sf)
}
)
}
# 604
for (i in 1384:nrow(buildable)){
if (buildable$valid[i] == FALSE){
sf <- st_sf(APN = buildable$APN[i], message = "Invalid geometry", geometry = st_sfc(st_polygon(), crs = 102643))
buildable_aadu <- rbind(buildable_aadu, sf)
next
}
poly <- st_geometry(buildable[i,]) %>% st_cast("POLYGON")
result <- st_sfc(st_polygon(), crs = 102643)
msg <- ""
print(i)
tryCatch(
{
for (j in 1:length(poly)){
print(j)
# Skip this one if the area is smaller than 160 SF (minimum area for ADU) or if there is no geometry
if (as.numeric(st_area(poly[j])) < 160){
msg <- paste(msg, "Area less than 160")
next
}
if (st_is_empty(poly[j])){
msg <- paste(msg, "Empty geometry")
next
}
if (!st_is_valid(poly[j])){
msg <- paste(msg, "Invalid geometry")
next
}
rect <- largestRect(poly[j], print = TRUE)
if (is.character(rect)){
msg <- paste(msg, rect)
}
else{
result <- st_union(result, rect)
}
}
if (length(result) == 0 || st_is_empty(result)){
sf <- st_sf(APN = buildable$APN[i], message = msg, geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = buildable$APN[i], message = "Success", geometry = result)
}
buildable_aadu <- rbind(buildable_aadu, sf)
},
error = function(e){
sf <- st_sf(APN = buildable$APN[i], message = msg, geometry = st_sfc(st_polygon(), crs = 102643))
buildable_aadu <- rbind(buildable_aadu, sf)
}
)
}
buildable[1384,]
# 604
for (i in 1384:nrow(buildable)){
if (buildable$valid[i] == FALSE){
sf <- st_sf(APN = buildable$APN[i], message = "Invalid geometry", geometry = st_sfc(st_polygon(), crs = 102643))
buildable_aadu <- rbind(buildable_aadu, sf)
next
}
tryCatch(
{
poly <- st_geometry(buildable[i,]) %>% st_cast("POLYGON")
result <- st_sfc(st_polygon(), crs = 102643)
msg <- ""
print(i)
for (j in 1:length(poly)){
print(j)
# Skip this one if the area is smaller than 160 SF (minimum area for ADU) or if there is no geometry
if (as.numeric(st_area(poly[j])) < 160){
msg <- paste(msg, "Area less than 160")
next
}
if (st_is_empty(poly[j])){
msg <- paste(msg, "Empty geometry")
next
}
if (!st_is_valid(poly[j])){
msg <- paste(msg, "Invalid geometry")
next
}
rect <- largestRect(poly[j], print = TRUE)
if (is.character(rect)){
msg <- paste(msg, rect)
}
else{
result <- st_union(result, rect)
}
}
if (length(result) == 0 || st_is_empty(result)){
sf <- st_sf(APN = buildable$APN[i], message = msg, geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = buildable$APN[i], message = "Success", geometry = result)
}
buildable_aadu <- rbind(buildable_aadu, sf)
},
error = function(e){
sf <- st_sf(APN = buildable$APN[i], message = msg, geometry = st_sfc(st_polygon(), crs = 102643))
buildable_aadu <- rbind(buildable_aadu, sf)
}
)
}
View(buildable_aadu)
unique(buildable_aadu$APN) %>% length()
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
buildable_aadu <- NULL
# 604
for (i in 1:nrow(buildable)){
if (buildable$valid[i] == FALSE){
sf <- st_sf(APN = buildable$APN[i], message = "Invalid geometry", geometry = st_sfc(st_polygon(), crs = 102643))
buildable_aadu <- rbind(buildable_aadu, sf)
next
}
tryCatch(
{
poly <- st_geometry(buildable[i,]) %>% st_cast("POLYGON")
result <- st_sfc(st_polygon(), crs = 102643)
msg <- ""
print(i)
for (j in 1:length(poly)){
print(j)
# Skip this one if the area is smaller than 160 SF (minimum area for ADU) or if there is no geometry
if (as.numeric(st_area(poly[j])) < 160){
msg <- paste(msg, "Area less than 160")
next
}
if (st_is_empty(poly[j])){
msg <- paste(msg, "Empty geometry")
next
}
if (!st_is_valid(poly[j])){
msg <- paste(msg, "Invalid geometry")
next
}
rect <- largestRect(poly[j], print = TRUE)
if (is.character(rect)){
msg <- paste(msg, rect)
}
else{
result <- st_union(result, rect)
}
}
if (length(result) == 0 || st_is_empty(result)){
sf <- st_sf(APN = buildable$APN[i], message = msg, geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = buildable$APN[i], message = "Success", geometry = result)
}
buildable_aadu <- rbind(buildable_aadu, sf)
},
error = function(e){
sf <- st_sf(APN = buildable$APN[i], message = msg, geometry = st_sfc(st_polygon(), crs = 102643))
buildable_aadu <- rbind(buildable_aadu, sf)
}
)
}
sum(flags$BufferFail)
plot(null)
# Find the available area after buffers. No building set back. Side = 5 ft, Rear = 10 ft, Street = 12 ft
buildable_area_a <- NULL
#Errors given for: 583, 1721, 3423
flags$BufferFail <- FALSE
for (i in 1){#:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
tryCatch(
# Try to run the code
{
geom <- allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)
plot(null)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
},
# If it runs into an error, flag it and add an empty geometry
error=function(e){
message(e)
flags$BufferFail[i] <- TRUE
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
for (i in 1){#:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
tryCatch(
# If it runs into an error, flag it and add an empty geometry
error=function(e){
message(e)
flags$BufferFail[i] <- TRUE
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
},
# Try to run the code
{
geom <- allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)
plot(null)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
for (i in 1){#:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
tryCatch(
# If it runs into an error, flag it and add an empty geometry
error=function(e){
message(e)
print("Test")
flags$BufferFail[i] <- TRUE
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
},
# Try to run the code
{
geom <- allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)
plot(null)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
i
flags$BufferFail[1]
for (i in 1){#:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
tryCatch(
# If it runs into an error, flag it and add an empty geometry
error=function(e){
message(e)
print("Test")
flags$BufferFail[i] <<- TRUE
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
},
# Try to run the code
{
geom <- allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)
plot(null)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
flags$BufferFail[1]
success <- TRUE
for (i in 1){#:length(modParcel)){
success <- TRUE
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
tryCatch(
# If it runs into an error, flag it and add an empty geometry.
error=function(e){
message(e)
success <- FALSE
print("Test")
flags$BufferFail[i] <<- TRUE
sf <<- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <<- rbind(buildable_area_a, sf)
},
# Try to run the code
{
geom <- allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)
plot(null)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
success
allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)
for (i in 1){#:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
geom <- tryCatch(
{allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)},
error = function(e){
flags$BufferFail[i] <<- TRUE       # Global assignment needed in tryCatch, otherwise doesn't assign
st_sfc(st_polygon(), crs = 102643)
}
)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
View(buildable_area_a)
for (i in 1){#:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
geom <- tryCatch(
{plot(null)},#allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)},
error = function(e){
flags$BufferFail[i] <<- TRUE       # Global assignment needed in tryCatch, otherwise doesn't assign
st_sfc(st_polygon(), crs = 102643)
}
)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
View(buildable_area_a)
i <- 1
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
geom <- tryCatch(
{allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)},
error = function(e){
flags$BufferFail[i] <<- TRUE       # Global assignment needed in tryCatch, otherwise doesn't assign
st_sfc(st_polygon(), crs = 102643)
}
)
geom
length(geom)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
# Find the available area after buffers. No building set back. Side = 5 ft, Rear = 10 ft, Street = 12 ft
buildable_area_a <- NULL
#Errors given for: 583, 1721, 3423
flags$BufferFail <- FALSE
for (i in 1){#:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
i <- 1
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
geom <- tryCatch(
{allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)},
error = function(e){
flags$BufferFail[i] <<- TRUE       # Global assignment needed in tryCatch, otherwise doesn't assign
st_sfc(st_polygon(), crs = 102643)
}
)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
View(buildable_area_a)
load("~/GitHub/maxrect/D2.RData")
mapview(buildable_area)
# Find the available area after buffers. No building set back. Side = 5 ft, Rear = 10 ft, Street = 12 ft
buildable_area_a <- NULL
#Errors given for: 583, 1721, 3423
flags$BufferFail <- FALSE
for (i in 1:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
i <- 1
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
geom <- tryCatch(
{allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)},
error = function(e){
flags$BufferFail[i] <<- TRUE       # Global assignment needed in tryCatch, otherwise doesn't assign
st_sfc(st_polygon(), crs = 102643)
}
)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
load("~/GitHub/maxrect/D2.RData")
# Find the available area after buffers. No building set back. Side = 5 ft, Rear = 10 ft, Street = 12 ft
buildable_area_a <- NULL
#Errors given for: 583, 1721, 3423
flags$BufferFail <- FALSE
for (i in 1:length(modParcel)){
if (sum(as.numeric(flags[i,-1])) == 0){
print(i)
st_par <- st_geometry(buildable_area[i,])
edges <- modParcel[[i]][,4]
st_bldg <- st_geometry(bldg_all[i,]) %>% st_buffer(0)
geom <- tryCatch(
{allBuffers(st_par, edges, st_bldg, 5, 10, 12, 0)},
error = function(e){
flags$BufferFail[i] <<- TRUE       # Global assignment needed in tryCatch, otherwise doesn't assign
st_sfc(st_polygon(), crs = 102643)
}
)
if (length(geom) == 0){
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = geom, crs = 102643)
}
buildable_area_a <- rbind(buildable_area_a, sf)
}
else{
sf <- st_sf(APN = parcels$APN[i], geometry = st_sfc(st_polygon(), crs = 102643))
buildable_area_a <- rbind(buildable_area_a, sf)
}
}
