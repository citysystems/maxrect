bldg[[6]][1]
bldg[[6]][[1]]
list(bldg[[6]][[1]])
st_area(bldg[[6]])
st_area(bldgs$geometry[[6]])
st_as_sf(bldg[[6]])
bldgs[[6]]
bldgs[6,]
bldgs[6,c("APN","geometry")]
?st_is_longlat(x)
file_bldg <- "epabldgs.geojson"
bldgs <- read_sf(file_bldg)
# Index buildings by APN ascending. NULL for APNs with no buildings
bldg <- vector("list", numPar)
for (i in 1:numPar){
apn <- parcels$properties.APN[[i]]
bldg[[i]] <- bldgs[match(apn, bldgs$APN), c("APN", "geometry")]
if (!is.null(bldg[[i]])){      # If not, there is a building
if (length(bldg[[i]] == 1)){  # If there is one building, convert from MULTIPOLYGON to POLYGON
bldg[[i]] <- st_cast(bldg[[i]], "POLYGON")
}
else{
}
}
}
file_bldg <- "epabldgs.geojson"
bldgs <- read_sf(file_bldg)
# Index buildings by APN ascending. NULL for APNs with no buildings
bldg <- vector("list", numPar)
for (i in 1:numPar){
apn <- parcels$properties.APN[[i]]
bldg[[i]] <- bldgs[match(apn, bldgs$APN), c("APN", "geometry")]
# if (!is.null(bldg[[i]])){      # If not, there is a building
#   if (length(bldg[[i]] == 1)){  # If there is one building, convert from MULTIPOLYGON to POLYGON
#     bldg[[i]] <- st_cast(bldg[[i]], "POLYGON")
#   }
#   else{
#
#   }
# }
}
bldg[1]
st_cast(bldg[1], "POLYGON")
st_cast(bldg[1, "geometry"], "POLYGON")
bldg[1, "geometry"]
View(bldg)
bldg <- vector("list", numPar)
for (i in 1:numPar){
apn <- parcels$properties.APN[[i]]
bldg[i] <- bldgs[match(apn, bldgs$APN), c("APN", "geometry")]
# if (!is.null(bldg[[i]])){      # If not, there is a building
#   if (length(bldg[[i]] == 1)){  # If there is one building, convert from MULTIPOLYGON to POLYGON
#     bldg[[i]] <- st_cast(bldg[[i]], "POLYGON")
#   }
#   else{
#
#   }
# }
}
View(bldg)
bldg <- vector("list", numPar)
for (i in 1:numPar){
apn <- parcels$properties.APN[[i]]
bldg[i,] <- bldgs[match(apn, bldgs$APN), c("APN", "geometry")]
# if (!is.null(bldg[[i]])){      # If not, there is a building
#   if (length(bldg[[i]] == 1)){  # If there is one building, convert from MULTIPOLYGON to POLYGON
#     bldg[[i]] <- st_cast(bldg[[i]], "POLYGON")
#   }
#   else{
#
#   }
# }
}
View(bldg)
bldg <- array(dim = c(numPar,2))
for (i in 1:numPar){
apn <- parcels$properties.APN[[i]]
bldg[i,] <- bldgs[match(apn, bldgs$APN), c("APN", "geometry")]
# if (!is.null(bldg[[i]])){      # If not, there is a building
#   if (length(bldg[[i]] == 1)){  # If there is one building, convert from MULTIPOLYGON to POLYGON
#     bldg[[i]] <- st_cast(bldg[[i]], "POLYGON")
#   }
#   else{
#
#   }
# }
}
View(bldg)
bldg <- array(dim = c(numPar,2))
View(bldg)
str(bldgs)
test <- st_read(file_bldg)
View(test)
dim(test)
str(test)
?data.frame()
geometry = st_sfc(lapply(1:numPar, function(x) st_geometrycollection()))
bldg <- st_sf(id = 1:numPar, geometry = geometry)
View(bldg)
bldg[1]
bldg[,1]
bldg[1,]
bldg[1,1]
geometry = st_sfc(lapply(1:numPar, function(x) st_geometrycollection()))
bldg <- st_sf(parcels$properties.APN, geometry = geometry)
geometry = st_sfc(lapply(1:numPar, function(x) st_geometrycollection()))
bldg <- st_sf(APN = parcels$properties.APN, geometry = geometry)
View(bldg$APN)
bldg$APN[[1]]
bldg$APN[1]
bldg$APN[1,]
View(bldg)
?sf()
browseVignettes(sf)
?browseVignettes()
dim(bldg)
bldg[1,1]
?lapply()
getBldg <- function(index){
apn <- parcels$properties.APN[[i]]
return(bldgs[match(apn, bldgs$APN), c("APN", "geometry")])
}
geometry = st_sfc(lapply(1:nrows, function(x) st_geometrycollection()))
geometry <- st_sfc(lapply(1:numPar, getBldg))
getBldg <- function(index){
apn <- parcels$properties.APN[[index]]
return(bldgs[match(apn, bldgs$APN), c("APN", "geometry")])
}
geometry <- st_sfc(lapply(1:numPar, getBldg))
View(geometry)
bldgs[1,c("APN", "geometry")]
geometry <- lapply(1:numPar, getBldg)
View(geometry)
View(geometry)
library(maxrectangle)
plotrect <- function(lr1){
## convert rectangle output to coordinates
## zero-centred
pts = cbind(
c(lr1$width,lr1$width,-lr1$width,-lr1$width)/2,
c(lr1$height,-lr1$height,-lr1$height,lr1$height)/2
)
## rotate
r = rmat(lr1$ang)
xy = pts %*% r
## add centre offsets
xy[,1] = xy[,1] + lr1$cx
xy[,2] = xy[,2] + lr1$cy
## repeat last point so output is a closed polygon
rbind(xy,xy[1,])
}
find_lr <- function(ct, xy, options){
## xy MUST be a two-column matrix. This transfers it as
## an Array of Arrays:
ct$assign("xy",xy)
## call the largest rectangle routine and return the result
## TODO: pass options here
# if(!missing(options)){ct$assign("options", options)}
tryCatch(
{
lrect = ct$get("window.largestRect(xy)")
lrect
}, error = function(e){
find_lr(ct, xy, options)
}
)
}
prepPoly <- function(poly){
poly <- apply(poly, c(1,2), round) # round the coordinates
minX <- min(poly[,1])              # get the smallest x coord
minY <- min(poly[,2])              # get the smallest y coord
poly[,1] <- poly[,1]- minX         # adjust for relative coordinates
poly[,2] <- poly[,2]- minY         # adjust for relative coordinates
return(list(poly,minX,minY))
}
listMaxRect <- vector("list", numPar)
ctx = initjs()
ctx = initjs()
ctx = initjs()
ctx = initjs()
library(maxrectangle)
ctx = initjs()
test <- prepPoly(cbind(c(0,8,8,6,6,8,8,0,0),c(0,0,2,2,4,4,6,6,0)))
plot(test)
test <- cbind(c(0,8,8,6,6,8,8,0,0),c(0,0,2,2,4,4,6,6,0))
plot(test)
}
ctx = initjs()
tryCatch({lr = find_lr(ctx, poly)
eqscplot(poly, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
print("success")
},
error = function(e){
print(paste("Error, skipping ", a, ", ", b))
error_poly[index_poly,] <<- c(a,b)
index_poly <<- index_poly + 1
})
ctx = initjs()
tryCatch({lr = find_lr(ctx, test)
eqscplot(poly, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
print("success")
},
error = function(e){
print(paste("Error, skipping ", a, ", ", b))
error_poly[index_poly,] <<- c(a,b)
index_poly <<- index_poly + 1
})
library(maxrectangle)
ctx = initjs()
tryCatch({lr = find_lr(ctx, test)
eqscplot(poly, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
print("success")
},
error = function(e){
print(paste("Error, skipping ", a, ", ", b))
error_poly[index_poly,] <<- c(a,b)
index_poly <<- index_poly + 1
})
library(maxrectangle)
test <- cbind(c(0,8,8,6,6,8,8,0,0),c(0,0,2,2,4,4,6,6,0))
ctx = initjs()
tryCatch({lr = find_lr(ctx, test)
eqscplot(poly, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
print("success")
},
error = function(e){
print("Error")
error_poly[index_poly,] <<- c(a,b)
index_poly <<- index_poly + 1
})
eqscplot(test, type='l')
library(maxrectangle)
ctx = initjs()
lr = find_lr(ctx, test)
pp = plotrect(lr[[1]])
lines(pp)
View(lr)
View(lr[[3]])
View(lr[[1]])
lr[[3]][1,]
plotrect(lr[[3]][1,])
length(lr[[3]])
library(maxrectangle)
test <- cbind(c(0,8,8,6,6,8,8,0,0),c(0,0,2,2,4,4,6,6,0))
ctx = initjs()
lr = find_lr(ctx, test)
View(lr)
library(maxrectangle)
test <- cbind(c(0,8,8,6,6,8,8,0,0),c(0,0,2,2,4,4,6,6,0))
ctx = initjs()
lr = find_lr(ctx, test)
View(lr)
rects <- vector("list", length(lr[[3]]))
for (i in 1:length(lr[[3]])){
rects[[i]] <- plotrect(lr[[3]][i,])
}
View(rects)
st_polygon(rects[[1]])
st_polygon(is.list(rects[[1]]))
st_polygon(list(rects[[1]]))
rects <- vector("list", length(lr[[3]]))
for (i in 1:length(lr[[3]])){
rects[[i]] <- st_polygon(list(plotrect(lr[[3]][i,])))
}
View(rects)
rects[[1]]
aggr <- rects[[1]]
?aggregate.sf()
rects
?st_sfc()
rects <- vector("list", length(lr[[3]]))
for (i in 1:length(lr[[3]])){
rects[i] <- st_polygon(list(plotrect(lr[[3]][i,])))
}
View(rects)
rects <- NULL
for (i in 1:length(lr[[3]])){
rects <- rbind(rects, st_sfc(st_polygon(list(plotrect(lr[[3]][i,])))))
}
rects
View(rects)
rects <- NULL
for (i in 1:length(lr[[3]])){
rects <- rbind(rects, st_sf(st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
View(rects)
rects <- NULL
for (i in 1:length(lr[[3]])){
rects <- rbind(rects, st_sf(index = i, st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
View(rects)
rects <- NULL
for (i in 1:length(lr[[3]])){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
rects
?st_union()
plot(rects)
aggr <- st_union(rects)
View(aggr)
plot(aggr)
eqscplot(test)
eqscplot(test, type='l')
lines(aggr)
lines(aggr[[1]][[1]])
pp = plotrect(lr[[1]])
lines(pp)
library(maxrectangle)
ctx = initjs()
lr = find_lr(ctx, test)
View(lr)
eqscplot(poly, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
rects <- NULL
for (i in 1:length(lr[[3]])){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
aggr <- st_union(rects)
eqscplot(test, type='l')
lines(aggr[[1]][[1]])
plot(aggr)
aggr <- st_union(rects)
eqscplot(test, type='l')
lines(aggr[[1]][[1]])
eqscplot(test, type='l')
for(i in 1:length(rects)){
lines(rects$geom[[i]])
}
rects$geom[[1]]
st_coordinates(rects$geom[[1]])
st_coordinates(rects$geom[[1]])[,1:2]
eqscplot(test, type='l')
for(i in 1:length(rects)){
lines(st_coordinates(rects$geom[[i]])[,1:2])
}
eqscplot(test, type='l')
st_coordinates(rects$geom[[2]])[,1:2]
lines(st_coordinates(rects$geom[[1]])[,1:2])
lines(st_coordinates(rects$geom[[2]])[,1:2])
lines(st_coordinates(rects$geom[[3]])[,1:2])
lines(st_coordinates(rects$geom[[4]])[,1:2])
lines(st_coordinates(rects$geom[[5]])[,1:2])
dim(lr[[3]])
View(lr[[3]])
length(lr[[3]])
rects <- NULL
for (i in 1:dim(lr[[3]])[1]){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
aggr <- st_union(rects)
eqscplot(test, type='l')
lines(st_coordinates(aggr))
plotParcel(1)
plotParcel(3)
plotParcel(3412)
plotParcel(1847)
plotParcel(2479)
plotParcel(2401)
test <- parcel[[2401]]
test
test <- prepParcel(parcel[[2401]][,1:2])
test <- prepPoly(parcel[[2401]][,1:2])
test
test <- prepPoly(parcel[[2401]][,1:2])[[1]]
test
eqscplot(test)
eqscplot(test, type='l')
test2 <- cbind(c(10,40,40,10,10),c(60,60,80,80,60))
test2 <- cbind(c(10,40,40,10,10),c(80,80,60,60,80))
lines(test2)
test3 <- rbind(test[,1],test2,test[,-1],test[,1])
View(test3)
test[,-1]
test3 <- rbind(test[1,],test2,test[-1,],test[1,])
eqscplot(test3, type='l')
test3 <- rbind(test[1,],test2,test[1,])
eqscplot(test3, type='l')
test3 <- rbind(test[1,],test2,test)
eqscplot(test3, type='l')
ctx = initjs()
lr = find_lr(ctx, test3)
eqscplot(test3, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
rects <- NULL
for (i in 1:dim(lr[[3]])[1]){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
View(rects)
View(lr[[3]])
aggr <- st_union(rects)
eqscplot(test, type='l')
lines(st_coordinates(aggr))
eqscplot(test3, type='l')
lines(st_coordinates(aggr))
test <- cbind(c(0,100,100,25,25,0,0),c(0,0,100,100,75,75,0))
eqscplot(test, type='l')
ctx = initjs()
test <- prepPoly(parcel[[2401]][,1:2])[[1]]
eqscplot(test, type='l')
test2 <- cbind(c(10,40,40,10,10),c(80,80,60,60,80))
lines(test2)
test3 <- rbind(test[1,],test2,test)
eqscplot(test3, type='l')
ctx = initjs()
lr = find_lr(ctx, test3)
lr = find_lr(ctx, test3)
eqscplot(test3, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
rects <- NULL
for (i in 1:dim(lr[[3]])[1]){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
aggr <- st_union(rects)
eqscplot(test3, type='l')
lines(st_coordinates(aggr))
test <- cbind(c(0,100,100,25,25,0,0),c(0,0,100,100,75,75,0))
ctx = initjs()
lr = find_lr(ctx, test3)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
ctx = initjs()
# tryCatch({
lr = find_lr(ctx, test3)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
lr = find_lr(ctx, test3)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
library(maxrectangle)
ctx = initjs()
lr = find_lr(ctx, test)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
View(lr)
View(lr[[3]])
rects <- NULL
for (i in 1:dim(lr[[3]])[1]){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
aggr <- st_union(rects)
eqscplot(test3, type='l')
eqscplot(test, type='l')
lines(st_coordinates(aggr))
library(maxrectangle)
ctx = initjs()
lr = find_lr(ctx, test)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
rects <- NULL
for (i in 1:dim(lr[[3]])[1]){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
aggr <- st_union(rects)
eqscplot(test, type='l')
lines(st_coordinates(aggr))
eqscplot(test, type='l')
View(rects)
length(rects)
for(i in 1:dim(rects)[1]){
lines(st_coordinates(rects$geom[[i]])[,1:2])
}
library(maxrectangle)
ctx = initjs()
lr = find_lr(ctx, test)
lr <- NULL
ctx = initjs()
lr = find_lr(ctx, test)
View(lr)
View(lr)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
rects <- NULL
for (i in 1:dim(lr[[3]])[1]){
rects <- rbind(rects, st_sf(index = i, geom = st_sfc(st_polygon(list(plotrect(lr[[3]][i,]))))))
}
aggr <- st_union(rects)
eqscplot(test, type='l')
lines(st_coordinates(aggr))
eqscplot(test, type='l')
for(i in 1:dim(rects)[1]){
lines(st_coordinates(rects$geom[[i]])[,1:2])
}
library(maxrectangle)
ctx = initjs()
lr <- NULL
lr = find_lr(ctx, test)
View(lr)
View(lr)
View(lr)
eqscplot(test, type= "l")
pp = plotrect(lr[[1]])
lines(pp)
