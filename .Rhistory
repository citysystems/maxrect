library(js)
install.packages("js")
install.packages("V8")
library(js)
demo <- readLines("largestRect.coffee")
js <- coffee_compile(demo)
View(demo)
demo[1]
demo[5]
demo[10]
?cat()
?readLines()
demo <- readLines("largestRect.coffee", package = "js")
?readLine()
?coffee_compile()
coffee_compile("square = (x) -> x * x")
js_validate_script(js)
js_validate_script(js)
demo <- readLines("largestRect.coffee")
js <- coffee_compile(demo)
js_validate_script(js)
library(v8)
library(v8)
library(V8)
ct <- v8()
ct$eval("var foo = 123")
ct$eval("var bar = 456")
ct$eval("foo + bar")
ct$eval(js)
cat(uglify_reformat(js, beautify = TRUE, indent_level = 2))
js <- cat(uglify_reformat(js, beautify = TRUE, indent_level = 2))
js <- cat(uglify_reformat(js, beautify = TRUE, indent_level = 2))
js <- coffee_compile(demo)
js_new <- cat(uglify_reformat(js, beautify = TRUE, indent_level = 2))
js_new <- cat(uglify_reformat(js, beautify = TRUE, indent_level = 2))
jshint(js)
js_validate_script(js)
jshint(js)
?ct$eval()
?eval()
ct$eval(js)
ct$source("https://requirejs.org/docs/release/2.3.6/minified/require.js")
ct$eval(js)
ct$source("https://raw.githubusercontent.com/mourner/simplify-js/master/simplify.js")
ct$eval(js)
js
ct$eval(js)
js <- coffee_compile(demo)
js_validate_script(js)
write(js,file="largestRect.js")
?read()
js_mod <- readLines("largestRect.js")
js_validate_script(js_mod)
js_mod <- readLines("largestRect.js")
js_validate_script(js_mod)
ct$eval(js_mod)
ct$source(system.file("simplify.js", package="V8"))
js <- coffee_compile(demo, bare = TRUE)
js_validate_script(js)
ct <- v8()
ct$source("https://requirejs.org/docs/release/2.3.6/minified/require.js")
ct$source("https://raw.githubusercontent.com/mourner/simplify-js/master/simplify.js")
ct$eval(js)
demo <- readLines("largestRect.coffee")
js <- coffee_compile(demo, bare = TRUE)
js_validate_script(js)
ct <- v8()
ct$source("https://requirejs.org/docs/release/2.3.6/minified/require.js")
ct$source("https://raw.githubusercontent.com/mourner/simplify-js/master/simplify.js")
ct$eval(js)
write(js, "largestRect.js")
write(js, "largestRect.js")
ct$console()
ct$console()
js_mod <- readLines("largestRect.js")
?parse()
cg
ct
initjs <- function(){
### initialise a v8 context and load d3, simplify, and the largest rectangle
### scripts
ct = v8()
ct$eval("window={}")
ct$source("http://d3js.org/d3.v3.min.js")
ct$source("http://d3plus.org/assets/posts/largestRect/lib/simplify.js")
### simplify loads into the window context but the largestRect needs it in main:
ct$eval("simplify = window.simplify")
### transpile to JS and evaluate
lr = coffee_compile(readLines("largestRect.coffee"))
ct$eval(lr)
### return the context
ct
}
find_lr <- function(ct, xy, options){
## xy MUST be a two-column matrix. This transfers it as
## an Array of Arrays:
ct$assign("xy",xy)
## call the largest rectangle routine and return the result
## TODO: pass options here
lrect = ct$get("window.largestRect(xy)")
lrect
}
rmat <- function(ang){
## rotation matrix
ang = ang*pi/180
sa = sin(ang)
ca = cos(ang)
rbind(c(ca,-sa),c(sa,ca))
}
plotrect <- function(lr1){
## convert rectangle output to coordinates
## zero-centred
pts = cbind(
c(lr1$width,lr1$width,-lr1$width,-lr1$width)/2,
c(lr1$height,-lr1$height,-lr1$height,lr1$height)/2
)
## rotate
r = rmat(lr1$ang)
xy = pts %*% r
## add centre offsets
xy[,1] = xy[,1] + lr1$cx
xy[,2] = xy[,2] + lr1$cy
## repeat last point so output is a closed polygon
rbind(xy,xy[1,])
}
ct = initjs()
demo <- readLines("largestRect.coffee")
js <- coffee_compile(demo, bare = TRUE)
js_validate_script(js)
write(js, "largestRect.js")
ct = initjs()
?npm()
vignette(npm)
?V8$npm()
npm install -g browserify
