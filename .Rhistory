Prop_Charge = Num_Charge/5000,
Prop_Drive = Num_Drive/5000,
P_elec = P_elec * 1000
) %>%
rename(Charge = Prop_Charge, Drive = Prop_Drive, Idle = Prop_Idle) %>%
gather(key = State, value = prop, c(Charge, Drive, Idle))
df3 <-
df2 %>%
mutate(hour = hour(time), minute = minute(time)) %>%
mutate(time = make_datetime(min = minute, hour = hour))
df4 <-
df3 %>%
select(time, `Trip ($)` = P_ride, `Electricity ($/kWh)` = P_elec) %>%
gather(key = Item, value = Price, c(`Trip ($)`, `Electricity ($/kWh)`))
df5 <-
df3 %>%
mutate(`Must Charge` = `Must_Charge` / 5000, `Fleet SOC` = U_ev_prop) %>%
select(time, `Must Charge`, `Fleet SOC`) %>%
gather(key = Type, value = Proportion, -time)
df6 <-
df3 %>%
select(time, Supply = S_max, Demand = D_max) %>%
gather(key = ` `, value = `#`, -time)
df4 <-
df3 %>%
select(time, `Trip ($)` = P_ride, `Electricity ($/MWh)` = P_elec) %>%
gather(key = Item, value = Price, c(`Trip ($)`, `Electricity ($/MWh)`))
df5 <-
df3 %>%
mutate(`Must Charge` = `Must_Charge` / 5000, `Fleet SOC` = U_ev_prop) %>%
select(time, `Must Charge`, `Fleet SOC`) %>%
gather(key = Type, value = Proportion, -time)
df6 <-
df3 %>%
select(time, Supply = S_max, Demand = D_max) %>%
gather(key = ` `, value = `#`, -time)
df3 %>%
ggplot(aes(x = time, y = prop)) +
geom_line(aes(color = State)) +
labs(
title = "Breakdown of EV Fleet State",
x = "Time",
y = "Proportion"
) +
scale_x_datetime(date_breaks = "2 hours", date_labels = "%H:%M") +
theme_bw()
df4 %>%
ggplot(aes(x = time, y = Price)) +
geom_line(aes(color = Item)) +
labs(
title = "EV Fleet Dynamic Pricing",
x = "Time",
y = "Cost"
) +
scale_x_datetime(date_breaks = "2 hours", date_labels = "%H:%M") +
theme_bw()
df5 %>%
ggplot(aes(x = time, y = Proportion)) +
geom_line(aes(color = Type)) +
labs(
title = "EV Fleet Charge Status",
x = "Time",
y = "Proportion"
) +
scale_x_datetime(date_breaks = "2 hours", date_labels = "%H:%M") +
theme_bw()
df6 %>%
ggplot(aes(x = time, y = `#`)) +
geom_line(aes(color = ` `)) +
labs(
title = "Supply-Demand",
x = "Time",
y = "Maximum Quantity"
) +
scale_x_datetime(date_breaks = "2 hours", date_labels = "%H:%M") +
theme_bw()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(stringr)
head(indiv)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(stringr)
file_base <- "~/224Z/"
indiv_file <- str_c(file_base, "indivTripData_3.csv")
joint_file <- str_c(file_base, "jointTripData_3.csv")
indiv <- read_csv(indiv_file)
save.image("~/224Z/tripaggr.RData")
indiv_mod <-
indiv %>%
filter(orig_taz != dest_taz)
indiv_aggr <-
indiv_mod %>%
group_by(orig_taz, dest_taz) %>%
summarise(n = n())
indiv_aggr_mode <-
indiv_mod %>%
filter(trip_mode <= 6) %>%
group_by(orig_taz, dest_taz, trip_mode) %>%
summarise(n = n())
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n())
head(indiv)
indiv_aggr_mode
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n()) %>%
mutate(
ifelse(
trip_mode <= 2,
count = n,
ifelse(
trip_mode <= 4,
count = n/2,
count = n/3
)
)
)
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n()) %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
)
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n()) %>%
ungroup() %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
)
indiv_aggr_mode %>%
group_by(trip_mode) %>%
summarise(n = n())
indiv_aggr_mode
indiv_aggr_mode %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
)
?gather()
?slice()
indiv_test %>%
slice(5)
indiv_aggr_mode %>%
slice(5)
indiv_aggr_mode %>%
head(n = 5)
indiv_aggr_mode %>%
head(n = 5) %>%
group_by(orig_taz, dest_taz) %>%
summarize(count = sum(n))
indiv_aggr_car <-
indiv_aggr_mode %>%
mutate(
count =
ifelse(
trip_mode <= 2,
n,
ifelse(trip_mode <= 4,
n / 2,
n / 3)
)
) %>%
group_by(orig_taz, dest_taz) %>%
summarize(car_count = sum(n))
x <- seq(2010, 2016, 1)
x <- seq(2010, 2016, 1)
x
library(tidyverse)
a <- seq(2010,2016,1)
b <- c(0.724, 0.717, 0.714, 0.707, 0.702, 0.699, 0.69)
trend.line(a,b)
mydf <- data.frame(x = a, y = b)
model <- lm(y ~ x, data = mydf)
plot(y ~ x, data = mydf)
model <- lm(y ~ x, data = mydf)
abline(model, col = "red")
summary(model)
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(readr)
library(stringr)
knitr::opts_chunk$set(echo = TRUE)
file_base <- "~/224Z/"
indiv_file <- str_c(file_base, "indivTripData_3.csv")
joint_file <- str_c(file_base, "jointTripData_3.csv")
joint <- read_csv(joint_file)
indiv <- read_csv(indiv_file)
install.packages()
help(install.packages())
install.packages("tidyverse", dependencies = TRUE)
setwd("~/GitHub/maxrect")
load("~/GitHub/maxrect/.RData")
View(bldg0_buildable)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
library(maxrectangle)
library(jsonlite)
library(readr)
library(MASS)
library(sp)
library(dplyr)
library(ggplot2)
library(ggrepel)
library(sf)
library(lwgeom)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
points(st_coordinates(bldg0_buildable[1,]))
eqscplot(st_coordinates(result_Bldg0[2,])[,1:2], type='l')
lines(st_coordinates(bldg0_buildable[2,]))
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
lines(st_coordinates(bldg0_buildable[1,]))
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
View(lr)
lr = find_lr(ctx, poly)
View(lr)
library(maxrectangle)
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
View(lr)
library(maxrectangle)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
View(lr)
View(test)
library(maxrectangle)
ctx = initjs()
lr <- NULL
lr = find_lr(ctx,test)
View(lr)
View(lr)
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
View(lr)
View(lr)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
points(st_coordinates(bldg0_buildable[1,]))
View(bldg0_buildable)
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
bldg0_buildable <- rbind(bldg0_buildable, sf)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
points(st_coordinates(bldg0_buildable[1,]))
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
lr = find_lr(ctx,test)
# Case 1: there is a region to merge together
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
bldg0_buildable <- rbind(bldg0_buildable, sf)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
# Case 1: there is a region to merge together
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
# Case 2: Nothing to show
else{
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(st_polygon()))
}
bldg0_buildable <- rbind(bldg0_buildable, sf)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
View(sf)
if (is.array(lr[[3]])){
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
}
View(sf)
bldg0_buildable <- rbind(bldg0_buildable, sf)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
View(bldg0_buildable)
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
bldg0_buildable <- rbind(bldg0_buildable, sf)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
eqscplot(st_coordinates(result_Bldg0[20,])[,1:2], type='l')
View(result_Bldg0)
st_coordinates(result_Bldg0[i,])
st_coordinates(result_Bldg0[1,])
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
i <- 1
par <- parcel[[i]][,1:2]
edges <- parcelEdges[[i]]
bldg <- st_coordinates(bldg_all[i,])[,1:2]
front <- parcelFront(i, "Mod")
side_dist <- 5
rear_dist <- 10
geom <- allBuffers(par, edges, bldg, front, side_dist, rear_dist, bldg_dist = 0)
if (is.character(geom) || nrow(geom) == 0){
sf <- st_sf(APN = parcels$properties.APN[[i]], valid = FALSE, geometry = st_sfc(st_polygon()))
}
else{
sf <- st_sf(data.frame(tibble(APN = parcels$properties.APN[[i]]),geom))
}
par <- parcel[[i]][,1:2]
edges <- parcelEdges[[i]]
bldg <- st_coordinates(bldg_all[i,])[,1:2]
front <- parcelFront(i, "Mod")
side_dist <- 5
rear_dist <- 10
geom <- allBuffers(par, edges, bldg, front, side_dist, rear_dist, bldg_dist = 0)
sf <- st_sf(APN = parcels$properties.APN[[i]], valid = FALSE, geometry = st_sfc(st_polygon()))
eqscplot(st_coordinates(sf))
View(sf)
par <- parcel[[i]][,1:2]
edges <- parcelEdges[[i]]
bldg <- st_coordinates(bldg_all[i,])[,1:2]
front <- parcelFront(i, "Mod")
side_dist <- 5
rear_dist <- 10
geom <- allBuffers(par, edges, bldg, front, side_dist, rear_dist, bldg_dist = 0)
View(geom)
sf <- st_sf(data.frame(tibble(APN = parcels$properties.APN[[i]]),geom))
eqscplot(st_coordinates(sf))
eqscplot(st_coordinates(sf), type='l')
ctx = initjs()
lr <- NULL
prep <- prepPoly(st_coordinates(sf)[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
View(lr)
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
bldg0_buildable <- rbind(bldg0_buildable, sf)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
eqscplot(st_coordinates(sf))
i <- 1
print(i)
par <- parcel[[i]][,1:2]
edges <- parcelEdges[[i]]
bldg <- st_coordinates(bldg_all[i,])[,1:2]
front <- parcelFront(i, "Mod")
side_dist <- 5
rear_dist <- 10
geom <- allBuffers(par, edges, bldg, front, side_dist, rear_dist, bldg_dist = 0)
if (is.character(geom) || nrow(geom) == 0){
sf <- st_sf(APN = parcels$properties.APN[[i]], valid = FALSE, geometry = st_sfc(st_polygon()))
}
else{
sf <- st_sf(data.frame(tibble(APN = parcels$properties.APN[[i]]),geom))
}
eqscplot(st_coordinates(sf), type='l')
test <- sf
ctx = initjs()
lr <- NULL
# prep <- prepPoly(st_coordinates(result_Bldg0[1,])[,1:2])
prep <- prepPoly(st_coordinates(test)[,1:2])
poly <- prep[[1]]
minX <- prep[[2]]
minY <- prep[[3]]
lr = find_lr(ctx, poly)
rects <- vector("list", dim(lr[[3]])[1])
for (i in 1:dim(lr[[3]])[1]){
rects[[i]] <- st_polygon(list(lr[[3]][i,,]))
}
merged_rects <- st_sfc(rects) %>% st_cast("POLYGON") %>% st_union()
merged_rects <- merged_rects + c(minX,minY)
sf <- st_sf(APN = result_Bldg0[[1]][1], geometry = st_sfc(merged_rects))
# Apply minimum 8 x 20 area to get rid of unviable spaces
# Merge the possible rectangles together
bldg0_buildable <- NULL
bldg0_buildable <- rbind(bldg0_buildable, sf)
eqscplot(st_coordinates(result_Bldg0[1,])[,1:2], type='l')
# eqscplot(st_coordinates(result_Bldg0[2,]), type='l')
lines(st_coordinates(bldg0_buildable[1,]))
